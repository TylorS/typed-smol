# Sample project: virtual modules + router plugin

This project demonstrates **two virtual module plugins** for testing and manual verification:

1. **`virtual:foo`** – Simple custom plugin (`plugin.mjs`) that exports a typed `Foo` interface and `DEFAULT`.
2. **`router:./routes`** – [@typed/app](https://github.com/typed-smol/typed-smol) router virtual module plugin: scans `./routes`, builds a typed router from route files (route + handler, optional guard/layout/dependencies/catch).

## Structure

- **`entry.ts`** – Imports only `virtual:foo` so `vmc --noEmit` passes without needing TypeInfo API in the compiler.
- **`router-demo.ts`** – Imports `router:./routes`; included in `tsconfig.json` so the TS plugin resolves it in VS Code. If you see "Cannot find module 'router:./routes'", run `pnpm build:plugins` and ensure the workspace is using this folder’s tsconfig (e.g. open the `sample-project` folder directly, or use a workspace that has this project root).
- **`plugin.mjs`** – Implements the `virtual:foo` virtual module as sync ESM (used by both the TS plugin and `vmc`).
- **`plugins/router-plugin.mjs`** – Bundled sync ESM build of `createRouterVirtualModulePlugin()` from `@typed/app`. Generated by `pnpm build:plugins`.
- **`vmc.config.ts`** – Shared virtual module config used by both `vmc` and the TS plugin.
- **`routes/`** – Route modules for the router plugin:
  - **Index / flat** – `index.ts`, `home.ts`, `about.ts`
  - **Nested** – `users/index.ts`, `users/[id].ts`
  - **Companions** – `settings.guard.ts`, `api/_layout.ts`; optional `*.dependencies.ts`, `*.catch.ts` and directory `_dependencies.ts`, `_catch.ts`

## Config variations (testing)

- **Default router plugin** – Prefix `router:`, name `router-virtual-module`. Used as `router:./routes` in `router-demo.ts`.
- **Custom prefix/name** – To test other options, add a second bundle (e.g. `scripts/router-plugin-custom-entry.mjs` calling `createRouterVirtualModulePlugin({ prefix: "app-routes:", name: "app-routes" })`) and build to `plugins/router-plugin-custom.mjs`, then add that plugin in `vmc.config.ts` and import `app-routes:./routes` where needed.

## Commands

```bash
# Install deps (from repo root: pnpm install; from sample-project: pnpm add -D esbuild)
pnpm install

# Generate CJS router plugin from @typed/app (required for router resolution in editor)
pnpm build:plugins

# Type-check with virtual modules (vmc uses vmc.config.ts)
pnpm run vmc --noEmit
```

Open this folder in VS Code (or any editor using tsserver) and ensure the TS plugin is configured in `tsconfig.json`. Then open `router-demo.ts` to verify `router:./routes` resolves and type-checks.
